

===== D:\BSUIR\Diploma\OwlReads-project\server-OwlReads\app\utils\email.py =====

import smtplib
import os
from email.message import EmailMessage
import random
import string
from dotenv import load_dotenv

load_dotenv()


def generate_verification_code(length=6):
    return ''.join(random.choices(string.digits, k=length))


def send_verification_email(to_email: str, code: str):

    SMTP_SERVER = "smtp.gmail.com"
    SMTP_PORT = 465

    SMTP_USER = os.getenv("SMTP_USER")
    SMTP_PASSWORD = os.getenv("SMTP_PASSWORD")

    if not SMTP_USER or not SMTP_PASSWORD:
        print("ОШИБКА: Не настроены SMTP_USER или SMTP_PASSWORD в .env файле!")
        print(f"Код для {to_email} был бы: {code}")  # Выводим в консоль для тестов
        return False

    msg = EmailMessage()
    msg.set_content(f"Добро пожаловать в OwlReads!\n\nВаш код подтверждения: {code}\n\nНикому не сообщайте этот код.")
    msg['Subject'] = "Код подтверждения OwlReads"
    msg['From'] = SMTP_USER
    msg['To'] = to_email

    try:
        with smtplib.SMTP_SSL(SMTP_SERVER, SMTP_PORT) as server:
            server.login(SMTP_USER, SMTP_PASSWORD)
            server.send_message(msg)
        print(f"Письмо успешно отправлено на {to_email}")
        return True
    except Exception as e:
        print(f"Ошибка отправки письма: {e}")
        return False

===== D:\BSUIR\Diploma\OwlReads-project\server-OwlReads\app\utils\__init__.py =====

