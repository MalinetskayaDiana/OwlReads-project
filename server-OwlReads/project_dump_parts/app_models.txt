

===== D:\BSUIR\Diploma\OwlReads-project\server-OwlReads\app\models\books_categories.py =====

from sqlalchemy import Column, Integer, String
from sqlalchemy.orm import relationship
from app.db.base import Base

class BookCategory(Base):
    __tablename__ = "books_categories"

    id = Column(Integer, primary_key=True, index=True)
    name = Column(String(50), unique=True, nullable=False)
    color = Column(String(7), nullable=False, server_default="#AB66FF")

    reviews = relationship("UserBookReview", back_populates="category")


===== D:\BSUIR\Diploma\OwlReads-project\server-OwlReads\app\models\books_editions.py =====

from sqlalchemy import Column, Integer, String, ForeignKey, Text
from sqlalchemy.orm import relationship
from app.db.base import Base

class BookEdition(Base):
    __tablename__ = "books_editions"

    id = Column(Integer, primary_key=True, index=True)
    literature_work_id = Column(Integer, ForeignKey("literature_works.id"), nullable=False)

    original_year = Column(Integer, nullable=True)
    description = Column(Text, nullable=True)
    publisher = Column(String(255), nullable=True)
    year = Column(Integer, nullable=True)
    pages = Column(Integer, nullable=True)
    cover_url = Column(String(500), nullable=True)
    isbn = Column(String(20), unique=True, nullable=True)
    language = Column(String(50), nullable=True)

    # связь с произведением
    work = relationship("LiteratureWork", back_populates="editions")


===== D:\BSUIR\Diploma\OwlReads-project\server-OwlReads\app\models\genre.py =====

from sqlalchemy import Column, Integer, String
from sqlalchemy.orm import relationship
from app.db.base import Base

class Genre(Base):
    __tablename__ = "genres"

    id = Column(Integer, primary_key=True, index=True)
    name = Column(String(200), unique=True, nullable=False)
    color = Column(String(7), nullable=False, server_default="#AB66FF")

    reviews = relationship("UserBookReviewGenre", back_populates="genre")




===== D:\BSUIR\Diploma\OwlReads-project\server-OwlReads\app\models\literature_works.py =====

from sqlalchemy import Column, Integer, String
from sqlalchemy.orm import relationship
from app.db.base import Base

class LiteratureWork(Base):
    __tablename__ = "literature_works"

    id = Column(Integer, primary_key=True, index=True)
    title = Column(String(255), nullable=False)
    author = Column(String(255), nullable=False)

    # связь с изданиями
    editions = relationship("BookEdition", back_populates="work", cascade="all, delete-orphan")


===== D:\BSUIR\Diploma\OwlReads-project\server-OwlReads\app\models\popular_quotes.py =====

from sqlalchemy import Column, Integer, String, Text
from app.db.base import Base

class PopularQuote(Base):
    __tablename__ = "popular_quotes"

    id = Column(Integer, primary_key=True, index=True)
    text = Column(Text, nullable=False)
    book_title = Column(String(255), nullable=False)


===== D:\BSUIR\Diploma\OwlReads-project\server-OwlReads\app\models\users_book_notes.py =====

from sqlalchemy import Column, Integer, Text, DateTime, ForeignKey
from sqlalchemy.orm import relationship
from datetime import datetime
from app.db.base import Base

class UserBookNote(Base):
    __tablename__ = "users_book_notes"

    id = Column(Integer, primary_key=True, index=True)
    text = Column(Text, nullable=False)

    # связь с users_book_review
    review_id = Column(Integer, ForeignKey("users_book_review.id"), nullable=False)

    date = Column(DateTime, default=datetime.utcnow)

    review = relationship("UserBookReview", back_populates="notes")


===== D:\BSUIR\Diploma\OwlReads-project\server-OwlReads\app\models\users_book_quotes.py =====

from sqlalchemy import Column, Integer, String, Text, DateTime, ForeignKey
from sqlalchemy.orm import relationship
from datetime import datetime
from app.db.base import Base

class UserBookQuote(Base):
    __tablename__ = "users_book_quotes"

    id = Column(Integer, primary_key=True, index=True)
    text = Column(Text, nullable=False)
    quote_author = Column(String(255), nullable=True)

    # связь с users_book_review
    review_id = Column(Integer, ForeignKey("users_book_review.id"), nullable=False)

    date = Column(DateTime, default=datetime.utcnow)


    review = relationship("UserBookReview", back_populates="quotes")




===== D:\BSUIR\Diploma\OwlReads-project\server-OwlReads\app\models\users_book_rating.py =====

from sqlalchemy import Column, Integer, ForeignKey
from sqlalchemy.orm import relationship
from app.db.base import Base

class UserBookRating(Base):
    __tablename__ = "users_book_rating"

    id = Column(Integer, primary_key=True, index=True)

    # связь c users_book_review
    review_id = Column(Integer, ForeignKey("users_book_review.id"), unique=True, nullable=False)

    total_rating = Column(Integer, nullable=False)
    characters_rating = Column(Integer, nullable=True)
    plot_rating = Column(Integer, nullable=True)
    relations_rating = Column(Integer, nullable=True)
    emotionality_rating = Column(Integer, nullable=True)
    ending_rating = Column(Integer, nullable=True)
    easy_reading_rating = Column(Integer, nullable=True)

    review = relationship("UserBookReview", back_populates="rating")


===== D:\BSUIR\Diploma\OwlReads-project\server-OwlReads\app\models\users_book_review.py =====

from sqlalchemy import Column, Integer, ForeignKey
from sqlalchemy.orm import relationship
from app.db.base import Base


class UserBookReview(Base):
    __tablename__ = "users_book_review"

    id = Column(Integer, primary_key=True, index=True)

    user_id = Column(Integer, ForeignKey("users_personal_data.id"), nullable=False)
    book_id = Column(Integer, ForeignKey("books_editions.id"), nullable=False)
    category_id = Column(Integer, ForeignKey("books_categories.id"), nullable=False)

    # --- СВЯЗИ ---
    user = relationship("UserPersonalData", back_populates="book_reviews")
    category = relationship("BookCategory", back_populates="reviews")

    # !!! ВОТ ЭТОЙ СТРОКИ НЕ ХВАТАЛО !!!
    book = relationship("BookEdition")

    # многие ко многим через join-таблицу
    genres = relationship("UserBookReviewGenre", back_populates="review", cascade="all, delete-orphan")

    # один к одному
    rating = relationship("UserBookRating", back_populates="review", uselist=False, cascade="all, delete-orphan")
    top_characters = relationship("UserTopCharacters", back_populates="review", uselist=False,
                                  cascade="all, delete-orphan")

    # один ко многим
    quotes = relationship("UserBookQuote", back_populates="review", cascade="all, delete-orphan")
    notes = relationship("UserBookNote", back_populates="review", cascade="all, delete-orphan")
    reading_records = relationship("UserReadingRecord", back_populates="review", cascade="all, delete-orphan")
    alphabet_challenges = relationship("UserChallengeBooksAlphabet", back_populates="review",
                                       cascade="all, delete-orphan")
    book_of_year_challenges = relationship("UserChallengeBookOfYear", back_populates="review",
                                           cascade="all, delete-orphan")

===== D:\BSUIR\Diploma\OwlReads-project\server-OwlReads\app\models\users_book_review_genres.py =====

from sqlalchemy import Column, Integer, ForeignKey
from sqlalchemy.orm import relationship
from app.db.base import Base

class UserBookReviewGenre(Base):
    __tablename__ = "users_book_review_genres"

    id = Column(Integer, primary_key=True, index=True)
    review_id = Column(Integer, ForeignKey("users_book_review.id"), nullable=False)
    genre_id = Column(Integer, ForeignKey("genres.id"), nullable=False)

    review = relationship("UserBookReview", back_populates="genres")
    genre = relationship("Genre", back_populates="reviews")


===== D:\BSUIR\Diploma\OwlReads-project\server-OwlReads\app\models\users_challenges.py =====

from sqlalchemy import Column, Integer, String, DateTime, ForeignKey
from sqlalchemy.orm import relationship
from datetime import datetime
from app.db.base import Base

class UserChallenge(Base):
    __tablename__ = "users_challenges"

    id = Column(Integer, primary_key=True, index=True)
    user_id = Column(Integer, ForeignKey("users_personal_data.id"), nullable=False)

    challenge_type = Column(String(50), nullable=False)
    started_at = Column(DateTime, default=datetime.utcnow)
    finished_at = Column(DateTime, nullable=True)
    status = Column(String(50), default="В процессе")

    user = relationship("UserPersonalData", back_populates="challenges")
    alphabet_entries = relationship("UserChallengeBooksAlphabet", back_populates="challenge")
    book_of_year_entries = relationship("UserChallengeBookOfYear", back_populates="challenge")


===== D:\BSUIR\Diploma\OwlReads-project\server-OwlReads\app\models\users_challenge_books_alphabet.py =====

from sqlalchemy import Column, Integer, String, ForeignKey
from sqlalchemy.orm import relationship
from app.db.base import Base

class UserChallengeBooksAlphabet(Base):
    __tablename__ = "users_challenge_books_alphabet"

    id = Column(Integer, primary_key=True, index=True)
    challenge_id = Column(Integer, ForeignKey("users_challenges.id"), nullable=False)
    user_id = Column(Integer, ForeignKey("users_personal_data.id"), nullable=False)

    # связь c users_book_review
    review_id = Column(Integer, ForeignKey("users_book_review.id"), nullable=False)

    letter = Column(String(1), nullable=False)

    challenge = relationship("UserChallenge", back_populates="alphabet_entries")
    user = relationship("UserPersonalData", back_populates="alphabet_challenges")
    review = relationship("UserBookReview", back_populates="alphabet_challenges")




===== D:\BSUIR\Diploma\OwlReads-project\server-OwlReads\app\models\users_challenge_book_of_year.py =====

from sqlalchemy import Column, Integer, String, Boolean, ForeignKey
from sqlalchemy.orm import relationship
from app.db.base import Base

class UserChallengeBookOfYear(Base):
    __tablename__ = "users_challenge_book_of_year"

    id = Column(Integer, primary_key=True, index=True)

    # связь с users_challenges
    challenge_id = Column(Integer, ForeignKey("users_challenges.id"), nullable=False)
    user_id = Column(Integer, ForeignKey("users_personal_data.id"), nullable=False)

    # связь c users_book_review
    review_id = Column(Integer, ForeignKey("users_book_review.id"), nullable=False)

    month = Column(Integer, nullable=True)   # месяц (1–12)
    stage = Column(String(50), nullable=False)  # этап: month/pair/group/final
    is_winner = Column(Boolean, default=False)

    challenge = relationship("UserChallenge", back_populates="book_of_year_entries")
    user = relationship("UserPersonalData", back_populates="book_of_year_challenges")
    review = relationship("UserBookReview", back_populates="book_of_year_challenges")


===== D:\BSUIR\Diploma\OwlReads-project\server-OwlReads\app\models\users_personal_data.py =====

from sqlalchemy import Column, Integer, String, Boolean, DateTime
from sqlalchemy.orm import relationship
from datetime import datetime
from app.db.base import Base

class UserPersonalData(Base):
    __tablename__ = "users_personal_data"

    id = Column(Integer, primary_key=True, index=True)
    username = Column(String(50), unique=True, nullable=False)
    email = Column(String(255), unique=True, nullable=False)
    password_hash = Column(String(255), nullable=False)

    agreement_accepted = Column(Boolean, default=False)
    registered_at = Column(DateTime, default=datetime.utcnow)
    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
    profile_photo = Column(String(255), nullable=True)

    # --- НОВЫЕ ПОЛЯ ---
    verification_code = Column(String(6), nullable=True)
    is_verified = Column(Boolean, default=False)
    # ------------------

    # обратные связи
    statistics = relationship("UserStatistics", back_populates="user", uselist=False)
    challenges = relationship("UserChallenge", back_populates="user")
    alphabet_challenges = relationship("UserChallengeBooksAlphabet", back_populates="user")
    book_of_year_challenges = relationship("UserChallengeBookOfYear", back_populates="user")
    book_reviews = relationship("UserBookReview", back_populates="user")

===== D:\BSUIR\Diploma\OwlReads-project\server-OwlReads\app\models\users_reading_records.py =====

from sqlalchemy import Column, Integer, String, Text, Date, ForeignKey
from sqlalchemy.orm import relationship
from app.db.base import Base

class UserReadingRecord(Base):
    __tablename__ = "users_reading_records"

    id = Column(Integer, primary_key=True, index=True)

    # связь c users_book_review
    review_id = Column(Integer, ForeignKey("users_book_review.id"), nullable=False)

    start_date = Column(Date, nullable=True)   # дата начала (может быть пустой)
    end_date = Column(Date, nullable=True)     # дата конца (может быть пустой)

    result = Column(String(50), nullable=False)  # Брошено / Завершено / В процессе
    comment = Column(Text, nullable=True)

    review = relationship("UserBookReview", back_populates="reading_records")

===== D:\BSUIR\Diploma\OwlReads-project\server-OwlReads\app\models\users_statistics.py =====

from sqlalchemy import Column, Integer, String, ForeignKey
from sqlalchemy.orm import relationship
from app.db.base import Base

class UserStatistics(Base):
    __tablename__ = "users_statistics"

    id = Column(Integer, primary_key=True, index=True)
    user_id = Column(Integer, ForeignKey("users_personal_data.id"), nullable=False)

    books_in_library = Column(Integer, default=0)
    books_read = Column(Integer, default=0)
    books_favorites = Column(Integer, default=0)
    favorite_author = Column(String(255), nullable=True)
    favorite_genre = Column(String(100), nullable=True)

    user = relationship("UserPersonalData", back_populates="statistics")


===== D:\BSUIR\Diploma\OwlReads-project\server-OwlReads\app\models\users_top_characters.py =====

from sqlalchemy import Column, Integer, String, ForeignKey
from sqlalchemy.orm import relationship
from app.db.base import Base

class UserTopCharacters(Base):
    __tablename__ = "users_top_characters"

    id = Column(Integer, primary_key=True, index=True)

    # связь c users_book_review
    review_id = Column(Integer, ForeignKey("users_book_review.id"), unique=True, nullable=False)

    top_1 = Column(String(255), nullable=True)
    top_2 = Column(String(255), nullable=True)
    top_3 = Column(String(255), nullable=True)
    top_4 = Column(String(255), nullable=True)
    top_5 = Column(String(255), nullable=True)

    review = relationship("UserBookReview", back_populates="top_characters")


===== D:\BSUIR\Diploma\OwlReads-project\server-OwlReads\app\models\__init__.py =====

from .popular_quotes import PopularQuote
from .genre import Genre
from .books_editions import BookEdition
from .literature_works import LiteratureWork
from .users_book_notes import UserBookNote
from .users_book_quotes import UserBookQuote
from .users_reading_records import UserReadingRecord
from .users_book_rating import UserBookRating
from .users_top_characters import UserTopCharacters
from .users_challenge_books_alphabet import UserChallengeBooksAlphabet
from .users_challenge_book_of_year import UserChallengeBookOfYear
from .users_challenges import UserChallenge
from .users_statistics import UserStatistics
from .users_personal_data import UserPersonalData
from .users_book_review_genres import UserBookReviewGenre
from .books_categories import BookCategory
from .users_book_review import UserBookReview

__all__ = ["PopularQuote",
           "Genre",
           "BookEdition",
           "LiteratureWork",
           "UserBookNote",
           "UserBookQuote",
           "UserReadingRecord",
           "UserBookRating",
           "UserTopCharacters",
           "UserChallengeBooksAlphabet",
           "UserChallengeBookOfYear",
           "UserChallenge",
           "UserStatistics",
           "UserPersonalData",
           "UserBookReviewGenre",
           "BookCategory",
           "UserBookReview"]
